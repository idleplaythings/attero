@(tileDefinition:String)

<!DOCTYPE html>
<html>
    <head>
        <title>Editor</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <link href="@routes.Assets.at("style/common.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/menubars.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/confirm.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/loadmapmenu.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/unitstatusicons.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/resourceLoader.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/TextureContainer.css")" rel="stylesheet" type="text/css">

        <link href="@routes.Assets.at("style/features/tileElementConfig.css")" rel="stylesheet" type="text/css">

        <link href="@routes.Assets.at("style/jquery-ui/jquery-ui.min.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/jquery-ui/jquery.ui.theme.css")" rel="stylesheet" type="text/css">

        <link href="@routes.Assets.at("style/ui/dialog.css")" rel="stylesheet" type="text/css">
        <link href="@routes.Assets.at("style/ui/dock.css")" rel="stylesheet" type="text/css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script src="@routes.Assets.at("js/lib/jquery.ba-throttle-debounce.min.js")"></script>
        <script src="@routes.Assets.at("js/lib/angular/angular.min.js")"></script>
        <script src="@routes.Assets.at("js/lib/angular-ui/build/angular-ui.min.js")"></script>
        <script src="@routes.Assets.at("js/lib/jquery-ui/ui/minified/jquery.ui.core.min.js")"></script>
        <script src="@routes.Assets.at("js/lib/jquery-ui/ui/minified/jquery.ui.widget.min.js")"></script>
        <script src="@routes.Assets.at("js/lib/jquery-ui/ui/minified/jquery.ui.mouse.min.js")"></script>
        <script src="@routes.Assets.at("js/lib/jquery-ui/ui/minified/jquery.ui.slider.min.js")"></script>
        <script src="@routes.Assets.at("js/requestAnimFrame.js")"></script>
        <script src="@routes.Assets.at("js/ResourceLoader.js")"></script>
        <script src="@routes.Assets.at("js/Loadable.js")"></script>
        <script src="@routes.Assets.at("js/Tile.js")"></script>
        <script src="@routes.Assets.at("js/GameTile.js")"></script>
        <script src="@routes.Assets.at("js/TileGrid.js")"></script>
        <script src="@routes.Assets.at("js/TileTexture.js")"></script>
        <script src="@routes.Assets.at("js/Three.js")"></script>
        <script src="@routes.Assets.at("js/Graphics.js")"></script>
        <script src="@routes.Assets.at("js/Scrolling.js")"></script>
        <script src="@routes.Assets.at("js/Zooming.js")"></script>
        <script src="@routes.Assets.at("js/Landscaping.js")"></script>
        <script src="@routes.Assets.at("js/SideSlideMenu.js")"></script>
        <script src="@routes.Assets.at("js/TileElement.js")"></script>
        <script src="@routes.Assets.at("js/ImageManipulation.js")"></script>
        <script src="@routes.Assets.at("js/WaterLayer.js")"></script>
        <script src="@routes.Assets.at("js/Grid.js")"></script>
        <script src="@routes.Assets.at("js/FogOfWar.js")"></script>
        <script src="@routes.Assets.at("js/ContourShadowDefinitions.js")"></script>
        <script src="@routes.Assets.at("js/Confirm.js")"></script>
        <script src="@routes.Assets.at("js/SaveLoad.js")"></script>
        <script src="@routes.Assets.at("js/MathLib.js")"></script>
        <script src="@routes.Assets.at("js/Interface.js")"></script>
        <script src="@routes.Assets.at("js/Coordinates.js")"></script>
        <script src="@routes.Assets.at("js/animation/AnimationHandler.js")"></script>
        <script src="@routes.Assets.at("js/events/EventDispatcher.js")"></script>
        <script src="@routes.Assets.at("js/events/EventListener.js")"></script>
        <script src="@routes.Assets.at("js/events/Event.js")"></script>
        <script src="@routes.Assets.at("js/button/Button.js")"></script>
        <script src="@routes.Assets.at("js/menu/LoadMenu.js")"></script>
        <script src="@routes.Assets.at("js/menu/SaveMenu.js")"></script>
        <script src="@routes.Assets.at("js/tileEffects/TileEffect.js")"></script>
        <script src="@routes.Assets.at("js/repository/TileRepository.js")"></script>
        <script src="@routes.Assets.at("js/repository/TileTrait.js")"></script>


        <script src="@routes.Assets.at("js/editor/landscaper/tools/LandscapingTool.js")"></script>
        <script src="@routes.Assets.at("js/editor/landscaper/tools/ElevateTool.js")"></script>

        <script src="@routes.Assets.at("js/angular/run.js")"></script>
        <script src="@routes.Assets.at("js/angular/services/editor/landscapingTool.js")"></script>
        <script src="@routes.Assets.at("js/angular/services/editor/menu/brush.js")"></script>
        <script src="@routes.Assets.at("js/angular/services/editor/menu/brushSize.js")"></script>
        <script src="@routes.Assets.at("js/angular/services/editor/menu/texture.js")"></script>
        <script src="@routes.Assets.at("js/angular/services/editor/menu/tileElement.js")"></script>


        <script src="@routes.Assets.at("js/angular/features/ui/iconMenu/directives/iconMenu.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/ui/dialog/dialog.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/ui/backdrop/backdrop.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/ui/anglePicker/anglePicker.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/ui/dock/dock.js")"></script>

        <script src="@routes.Assets.at("js/angular/features/editor/tileElementConfig/directives/tileElementPreview.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/editor/tileElementConfig/controllers/toolPreview.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/editor/tileElementConfig/directives/tileElementGrid.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/editor/tileElementConfig/directives/tileElementConfig.js")"></script>
        <script src="@routes.Assets.at("js/angular/features/editor/tileElementPreview/tileElementPreview.js")"></script>

        <!-- <script src="@routes.Assets.at("js/angular/directives/slideMenu.js")"></script> -->

        <script src="@routes.Assets.at("js/angular/services/ui/dialogService.js")"></script>

        <script>

            window.TileRepository = new TileRepository("@tileDefinition", ResourceLoader);

            function constructControllers()
            {
                window.UIEventDispatcher = new Dispatcher();
                window.Graphics = new Graphics(UIEventDispatcher);
                window.landscaping = new Landscaping(UIEventDispatcher, TileGrid);
                window.saveLoad = new SaveLoad(UIEventDispatcher);
            }

            function init()
            {

                Graphics.init();
                Graphics.animate();
                WaterLayer.init();
                Grid.init();

                var canvas = jQuery(".webglCanvas");

                // window.textureMenu = new SideSlideMenuTextures('right', 0, 'top:60px', 'auto', window.availableTextures, landscaping);
                // window.brushMenu = new SideSlideMenuBrush('left', 0, 'top:60px', 'auto', landscaping);
                // window.brushMenu = new SideSlideMenuBrushSize('left', 0, 'top:140px', 'auto', landscaping);
                // window.tileElementMenu = new SideSlideMenuTileElements('right', 0, 'top:350px', 'auto', window.availableTileElements, landscaping);

                var scrolling = new Scrolling(canvas, UIEventDispatcher);
                var zooming = new Zooming(canvas, UIEventDispatcher);

                var tileSize = 20; // this doesn't belong here

                var coordinasService = new Coordinates(tileSize, TileGrid.getMapSizeInGameTiles().width);

                window.interface = new Interface(coordinasService, TileGrid, canvas, UIEventDispatcher);
                window.interface.init();

                var topMenuRight = $('.menubar.top .right');

                var loadIcon = new Button(topMenuRight, 'loadicon.png', UIEventDispatcher, new Event("player", "LoadMapEvent"));
                var saveIcon = new Button(topMenuRight, 'saveicon.png', UIEventDispatcher, new Event("player", "SaveMapEvent"));

                scrolling.init();
            }


            function staticResourcesLoaded()
            {
                constructControllers();

                TileGrid.width = 201;
                TileGrid.height = 201;

                var hash = '';
                if (location.hash)
                {
                    hash = location.hash.replace(/#/, '');
                    hash = parseInt(hash);
                }

                if ($.isNumeric(hash) && hash % 1 === 0)
                {
                    window.saveLoad.loadMap(hash);
                }
                else
                {
                    TileGrid.createDefaultGameTiles();
                    ResourceLoader.loadTiles(function(){ResourceLoader.remove()});
                }

                init();
            }

            jQuery(function(){

                window.textureMasks =
                {
                    1:  ResourceLoader.loadImage("/assets/textures/texturemask.png"),
                    2:  ResourceLoader.loadImage("/assets/textures/shadowBrushes.png")
                };

                window.unitTilesets =
                {
                    "ge_tanks": ResourceLoader.loadImage("/assets/units/stug_III.png"),
                    "ge_infantry": ResourceLoader.loadImage("/assets/units/ge_infantry.png")
                }

                ResourceLoader.run(staticResourcesLoaded);
            });
        </script>

    </head>
    <body oncontextmenu="return false;" ng-app="attero">
		<table class="menubar top">
			<tr>
				<td class="left">

				</td>
				<td class="center">
					<h2>MAP EDITOR</h2>
				</td>
				<td class="right">

				</td>
			</tr>
		</table>
        <!-- <canvas id="testcanvas" width="40" height="40" style="position:absolute;z-index:200;border:1px solid white;"></canvas> -->
        <div id="texturecontainer"></div>

        <div icon-menu service="brush" columns="4" dock="left" top="60"></div>
        <div icon-menu service="brushSize" columns="4" dock="left" top="140"></div>
        <div icon-menu service="texture" columns="4" dock="right" top="60"></div>
        <div icon-menu service="tileElement" columns="4" dock="right" top="260"></div>

        <div ng-controller="toolPreviewController">
            <div class="tile-element-config" dock="bottom" peek="40" ui-if="tileElement">
                <div tile-element-preview></div>
                <div angle-picker></div>
                <div class="tile-element-grid">
                    rows: {{ rowCount }}, columns: {{ columnCount }}
                    <div class="tile-element-grid-item row" ng-repeat="row in tileSet">
                        <div class="tile-element-grid-item column" ng-repeat="column in row">
                            <div tile-element-previewxx />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-39126112-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

        </script>
    </body>
</html>
